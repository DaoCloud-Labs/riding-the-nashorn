<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Niko Köbler">
<title>Riding the Nashorn</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="css//asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css//coderay-asciidoctor.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Riding the Nashorn</h1>
<div class="details">
<span id="author" class="author">Niko Köbler</span><br>
<span id="email" class="email"><a href="mailto:niko@n-k.de">niko@n-k.de</a>, <a href="http://www.n-k.de" class="bare">http://www.n-k.de</a>, <a href="https://twitter.com/dasniko">@dasniko</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_nashorn_at_the_command_line_interface_cli">1. Nashorn at the Command Line Interface (CLI)</a>
<ul class="sectlevel2">
<li><a href="#_scripting_mode">1.1. Scripting mode</a></li>
<li><a href="#_shebang">1.2. Shebang</a></li>
</ul>
</li>
<li><a href="#_nashorn_javascript_engine_from_within_java">2. Nashorn JavaScript Engine from within Java</a>
<ul class="sectlevel2">
<li><a href="#_invoking_javascript_functions_from_java">2.1. Invoking JavaScript functions from Java</a></li>
<li><a href="#_invoking_java_methods_from_javascript">2.2. Invoking Java methods from JavaScript</a></li>
<li><a href="#_scriptobjectmirror">2.3. ScriptObjectMirror</a></li>
<li><a href="#_options_for_the_script_engine">2.4. Options for the script engine</a></li>
<li><a href="#_bindings_context">2.5. Bindings / Context</a></li>
</ul>
</li>
<li><a href="#_api_and_language_extensions">3. API and Language Extensions</a>
<ul class="sectlevel2">
<li><a href="#_print_function">3.1. Print Function</a></li>
<li><a href="#_java_beans">3.2. Java Beans</a></li>
<li><a href="#_function_literals">3.3. Function Literals</a></li>
<li><a href="#_binding_properties">3.4. Binding Properties</a></li>
<li><a href="#_trimming_strings">3.5. Trimming Strings</a></li>
<li><a href="#_whereis">3.6. Whereis</a></li>
<li><a href="#_import_scopes">3.7. Import Scopes</a></li>
<li><a href="#_packages">3.8. Packages</a></li>
<li><a href="#_typed_arrays">3.9. Typed Arrays</a></li>
<li><a href="#_collections_and_for_each">3.10. Collections and For-Each</a></li>
<li><a href="#_convert_arrays">3.11. Convert Arrays</a></li>
<li><a href="#_lambdas_and_streams">3.12. Lambdas and Streams</a></li>
<li><a href="#_extending_classes">3.13. Extending Classes</a></li>
<li><a href="#_calling_super">3.14. Calling Super</a></li>
<li><a href="#_loading_scripts">3.15. Loading Scripts</a></li>
</ul>
</li>
<li><a href="#_working_with_package_manager">4. Working with Package Manager</a>
<ul class="sectlevel2">
<li><a href="#_npm">4.1. NPM</a></li>
<li><a href="#_maven">4.2. Maven</a></li>
</ul>
</li>
<li><a href="#_isomorphic_javascript">5. Isomorphic JavaScript</a>
<ul class="sectlevel2">
<li><a href="#_isomorphic">5.1. Isomorphic?</a></li>
<li><a href="#_react_js">5.2. React.js</a></li>
<li><a href="#_spring_boot_mvc">5.3. Spring Boot MVC</a></li>
<li><a href="#_java_ee_8_mvc_1_0">5.4. Java EE 8 MVC 1.0</a></li>
</ul>
</li>
<li><a href="#_javafx_with_javascript">6. JavaFX with JavaScript</a></li>
<li><a href="#_testing_of_nashorn_scripts">7. Testing of Nashorn Scripts</a>
<ul class="sectlevel2">
<li><a href="#_junit">7.1. JUnit</a></li>
<li><a href="#_spock">7.2. Spock</a></li>
<li><a href="#_jasmine">7.3. Jasmine</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Nashorn is the official JavaScript Engine in the Java Virtual Machine since Version 8.
It supports and implements the <a href="http://www.ecma-international.org/ecma-262/5.1/">ECMAScript 5.1 specification</a> and competes among others directly with <a href="https://developers.google.com/v8/">Google V8</a> (the script enginge behind <a href="https://nodejs.org">Node.js</a>).
Nashorn compiles JavaScript to Java Bytecode during runtime and thus provides high interoperability of Java and JavaScript.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/nashorn.jpg" alt="Nashorn">
</div>
</div>
<div class="paragraph">
<p>In this script I want to dig into some of the (IMO) most used options, functions, features, and use-cases.
After working through this tutorial you&#8217;ll be able to use Nashorn and its dynamic scripting features in your daily Java business.</p>
</div>
<div class="paragraph">
<p><em>Another good starting point for Nashorn resources might be the <a href="http://openjdk.java.net/projects/nashorn/">Official Project Nashorn Website</a> with links to the mailing-list, the blog and the wiki pages. Check it out!</em></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Nashorn in JDK 8 implements, as mentioned above the ECMAScript 5.1 specification. But it&#8217;s Nashorns strategy to follow the ECMAScript spec.
So the follow up major releases of Nashorn will implement <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 2015 spec</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nashorn_at_the_command_line_interface_cli">1. Nashorn at the Command Line Interface (CLI)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nashorn comes with a command line client named <code>jjs</code>.</p>
</div>
<div class="paragraph">
<p>This client is located in <code>$JAVA_HOME/bin</code>, but there&#8217;s no shortcut/link/path integration after installation Java 8.
So, if you want to work with <code>jjs</code> - and that&#8217;s what we want to do here - you should create a link to the tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /usr/bin
$ ln -s $JAVA_HOME/bin/jjs jjs
$ jjs
jjs&gt; print('Hello World');</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now evaluate JavaScript code directly in the jjs shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">jjs&gt; <span class="keyword">var</span> x = <span class="integer">10</span>;
jjs&gt; print(x);
<span class="integer">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally you can load and execute JavaScript files with the <code>jjs</code> tool:</p>
</div>
<div class="listingblock">
<div class="title">test.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="keyword">var</span> x = <span class="integer">10</span>;
<span class="keyword">var</span> y = <span class="integer">20</span>;
print(x + y);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ jjs test.js
30</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Exiting</strong></p>
</div>
<div class="paragraph">
<p>The <code>jjs</code> client can be exited by calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">jjs&gt; exit()
jjs&gt; exit(<span class="integer">1</span>)

jjs&gt; quit()
jjs&gt; quit(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Help / Options</strong></p>
</div>
<div class="paragraph">
<p>List all options of <code>jjs</code> by calling it with the <code>-help</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ jjs -help</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_scripting_mode">1.1. Scripting mode</h3>
<div class="paragraph">
<p>In addition to the ECMAScript 5.1 specification, Nashorn implements a number of own syntax and API extensions as well <em>(see one of the next chapters)</em>.
Many of these extensions are only available in <code>scripting</code> mode. <code>Scripting</code> mode is turned on by using the cli option <code>--scripting</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ jjs --scripting</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>scripting</code> mode, nashorn accepts shell style <code>#</code> single line comments:</p>
</div>
<div class="listingblock">
<div class="title">test.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="error">#</span> style line comment -scripting mode
<span class="error">#</span> prints hello

print(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shebang">1.2. Shebang</h3>
<div class="paragraph">
<p>Nashorn supports shebang scripting.
So, instead of calling your JavaScript file like the traditional way:</p>
</div>
<div class="listingblock">
<div class="title">test.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">print(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ jjs test.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just write your JavaScript file like the following with a shebang at first line:</p>
</div>
<div class="listingblock">
<div class="title">test.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="error">#</span>!<span class="regexp"><span class="delimiter">/</span><span class="content">usr</span><span class="delimiter">/</span></span>bin/jjs
print(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>make it executable and call it from the command line, like any other shell script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ chmod 755 test.js
$ ./test.js</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You&#8217;ll need to have a link to <code>jjs</code> as mentioned at the beginning of this chapter.<br>
Scripting mode is automatically enabled when running shebang Nashorn scripts.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nashorn_javascript_engine_from_within_java">2. Nashorn JavaScript Engine from within Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Nashorn Engine is a JavaScript implementation of the <a href="https://www.jcp.org/en/jsr/detail?id=223">JSR-223</a> <em>(Scripting for the Java Platform)</em>. It implements the <code>javax.script</code> API.
So, for being able to evaluate JavaScript code from Java, we just create a new Nashorn <code>javax.script.ScriptEngine</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">nashorn</span><span class="delimiter">&quot;</span></span>);
engine.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">print('Hello World');</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, JavaScript code can be evaluated directly by passing it as a string to the <code>eval()</code> method of the engine object.
Alternatively you can parse a <code>.js</code>-file by passing a <code>FileReader</code> object pointing to your file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">nashorn</span><span class="delimiter">&quot;</span></span>);
engine.eval(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(<span class="string"><span class="delimiter">'</span><span class="content">test.js</span><span class="delimiter">'</span></span>));</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_invoking_javascript_functions_from_java">2.1. Invoking JavaScript functions from Java</h3>
<div class="paragraph">
<p>It&#8217;s not only possible to run single JS statements or evaluate complete JS files, but it&#8217;s also possible to invoke JavaScript functions from within Java code.
Additionally you can pass Java objects as function arguments and return data back from the function to the calling Java method.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our JavaScript file:</p>
</div>
<div class="listingblock">
<div class="title">example.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> <span class="function">sayHello</span> = <span class="keyword">function</span>(name) {
  print(<span class="string"><span class="delimiter">'</span><span class="content">Hello, </span><span class="delimiter">'</span></span> + name + <span class="string"><span class="delimiter">'</span><span class="content">!</span><span class="delimiter">'</span></span>);
  <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">hello from javascript</span><span class="delimiter">'</span></span>;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to call our defined <code>sayHello</code> function, we first have to cast the <code>engine</code> object to the <code>Invocable</code> interface, which is implemented by the <code>NashornScriptEngine</code> implementation.
The <code>Invocable</code> interface provides the <code>invokeFunktion()</code> method, which allows to call JavaScript functions for a given name and pass arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">nashorn</span><span class="delimiter">&quot;</span></span>);
engine.eval(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(<span class="string"><span class="delimiter">'</span><span class="content">example.js</span><span class="delimiter">'</span></span>));

Invocable invocable = (Invocable) engine;

<span class="predefined-type">Object</span> result = invocable.invokeFunction(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">System</span>.out.println(result);
<span class="predefined-type">System</span>.out.println(result.getClass());

<span class="comment">// Hello, John Doe!</span>
<span class="comment">// hello from javascript</span>
<span class="comment">// class java.lang.String</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our code prints three lines to the console: The JavaScript function <code>print()</code> pipes the result to <code>System.out</code>, afterwards, the two Java <code>System.out.println()</code> methods are evaluated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_invoking_java_methods_from_javascript">2.2. Invoking Java methods from JavaScript</h3>
<div class="paragraph">
<p>Calling or invoking Java methods from JavaScript code is just as easy as vice-versa. Let&#8217;s assume a Java class with two methods:</p>
</div>
<div class="listingblock">
<div class="title">MyJavaClass.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">my.package</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyJavaClass</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> sayHello(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello %s from Java!</span><span class="delimiter">&quot;</span></span>, name);
    }

    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> a, <span class="type">int</span> b) {
        <span class="keyword">return</span> a + b;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our Java class can be referenced from JavaScript via the <code>Java.type</code> API extension. This is similar to the <code>import</code> statement in Java.
After referencing our Java class, we can call the static method and print the result to <code>System.out</code>.
Since the <code>sayHello()</code> method is static, we don&#8217;t have to create an instance as we have to do for calling the <code>add()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> MyJavaClass = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">my.package.MyJavaClass</span><span class="delimiter">'</span></span>);

<span class="keyword">var</span> greetingResult = MyJavaClass.sayHello(<span class="string"><span class="delimiter">'</span><span class="content">John Doe</span><span class="delimiter">'</span></span>);
print(greetingResult);

<span class="keyword">var</span> myClass = <span class="keyword">new</span> MyJavaClass();
<span class="keyword">var</span> calcResult = myClass.add(<span class="integer">1</span>, <span class="integer">2</span>);
print(calcResult);

<span class="comment">// Hello John Doe from Java!</span>
<span class="comment">// 3</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_nashorn_type_conversions">2.2.1. Nashorn type conversions</h4>
<div class="paragraph">
<p>With this little example, you can find out, how Nashorn handles type conversions between Java and JavaScript, when calling Java methods from JavaScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> printType(<span class="predefined-type">Object</span> object) {
    <span class="predefined-type">System</span>.out.println((object.getClass());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, call this static method with different JavaScript types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">MyJavaClass.printType(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// class java.lang.String</span>

MyJavaClass.printType(<span class="integer">123</span>);
<span class="comment">// class java.lang.Integer</span>

MyJavaClass.printType(<span class="float">12.34</span>);
<span class="comment">// class java.lang.Double</span>

MyJavaClass.printType(<span class="predefined-constant">true</span>);
<span class="comment">// class java.lang.Boolean</span>

MyJavaClass.printType(<span class="keyword">new</span> Number(<span class="integer">123</span>));
<span class="comment">// class jdk.nashorn.internal.objects.NativeNumber</span>
<span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span>

MyJavaClass.printType(<span class="keyword">new</span> Date());
<span class="comment">// class jdk.nashorn.internal.objects.NativeDate</span>
<span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span>

MyJavaClass.printType(<span class="keyword">new</span> RegExp());
<span class="comment">// class jdk.nashorn.internal.objects.NativeRegExp</span>
<span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span>

MyJavaClass.printType({<span class="key">foo</span>: <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>});
<span class="comment">// class jdk.nashorn.internal.scripts.J04</span>
<span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Primitive JavaScript types are converted to the appropriate Java wrapper class.</p>
</li>
<li>
<p>Native JavaScript objects are represented by internal adapter classes, respectively to <code>ScriptObjectMirror</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t rely on programming against / using internal classes in <code>jdk.nashorn.internal</code> as they are likely subject to change!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scriptobjectmirror">2.3. ScriptObjectMirror</h3>
<div class="paragraph">
<p>The <code>ScriptObjectMirror</code> is part of the <code>jdk.nashorn.api</code> and is intended to be used in client-code instead of the internal classes.
This mirror object is a representation of the underlying JavaScript object and provides access to it and its methods and properties.
The <code>ScriptObjectMirror</code> implements the <code>Map</code> interface.</p>
</div>
<div class="paragraph">
<p>We edit our last method slightly to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> printObjectMirror(ScriptObjectMirror mirror) {
    <span class="predefined-type">System</span>.out.println(mirror.getClassName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(mirror.getOwnKeys(<span class="predefined-constant">true</span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we call this method now with our last four JS function calls (number, date, regexp and object literal):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">MyJavaClass.printType(<span class="keyword">new</span> Number(<span class="integer">123</span>));
MyJavaClass.printType(<span class="keyword">new</span> Date());
MyJavaClass.printType(<span class="keyword">new</span> RegExp());
MyJavaClass.printType({
    <span class="key">foo</span>: <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>,
    <span class="key">bar</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>we now get this result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Number: []
Date: []
RegExp: [lastIndex, source, global, ignoreCase, multiline]
Object: [foo, bar]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, we can call member functions on JavaScript objects from Java.<br>
Let&#8217;s assume a JavaScript type <code>Person</code> with some properties and a function <code>getFullName()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">function</span> <span class="function">Person</span>(firstName, lastName) {
  <span class="local-variable">this</span>.firstName = firstName;
  <span class="local-variable">this</span>.lastName = lastName;
  <span class="local-variable">this</span>.<span class="function">getFullName</span> = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.firstName + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.lastName;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function <code>getFullName()</code> can be called on <code>ScriptObjectMirror</code> via <code>callMember()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> getFullName(ScriptObjectMirror person) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Full name is: </span><span class="delimiter">&quot;</span></span> + person.callMember(<span class="string"><span class="delimiter">&quot;</span><span class="content">getFullName</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our JavaScript code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">'</span><span class="content">John</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Doe</span><span class="delimiter">'</span></span>);
MyJavaClass.getFullName(person);

<span class="comment">// Full name is: John Doe</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_options_for_the_script_engine">2.4. Options for the script engine</h3>
<div class="paragraph">
<p>Nashorn script engine customization can be done by using <code>nashorn.args</code> system properties.
Just specify the options you want with <code><strong>-Dnashorn.args=&#8230;&#8203;</strong></code>
E.g. enabling the scripting mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -Dnashorn.args=-scripting MyJavaClass</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create a Nashorn engine by passing customization options programmatically.
In this case, you&#8217;ll have to instantiate <code>NashornScriptEngineFactory</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NashornScriptEngineFactory factory = <span class="keyword">new</span> NashornScriptEngineFactory();
ScriptEngine engine = factory.getScriptEngine(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> { <span class="string"><span class="delimiter">&quot;</span><span class="content">-scripting</span><span class="delimiter">&quot;</span></span> });</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Available options can be determined from the <a href="#_nashorn_at_the_command_line_interface_cli">command line</a> when calling <code>jjs -help</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bindings_context">2.5. Bindings / Context</h3>
<div class="paragraph">
<p>A <code>ScriptContext</code> contains one or more bindings, each associated to a scope. By default, there are two scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ENGINE_SCOPE</code></p>
</li>
<li>
<p><code>GLOBAL_SCOPE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a Nashorn engine is created, it creates a default context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScriptContext defaultContext = engine.getContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default context&#8217;s <code>ENGINE_SCOPE</code> is the scope where ECMAScript "global" objects and functions (<code>Object</code>, <code>Function</code>, <code>Math</code>, <code>RegExp</code>, <code>parseInt</code>, etc.) are stored.
The <code>GLOBAL_SCOPE</code> is shared between all engines created by the same <code>ScriptEngineManager</code>.</p>
</div>
<div class="paragraph">
<p>You can store variables in the context (use of the scope is optional, default is <code>ENGINE_SCOPE</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">ScriptContext context = engine.getContext();
<span class="comment">// stores an object under the key `myKey` in the (engine scoped) context</span>
context.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>, object, ScriptContext.ENGINE_SCOPE);
<span class="comment">// retrieves the object with key `myKey` from (engine scoped) context</span>
context.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>, ScriptContext.ENGINE_SCOPE);

Bindings b = context.getBindings(ScriptContext.ENGINE_SCOPE);
b.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">Object</span><span class="delimiter">&quot;</span></span>);    <span class="comment">// gets ECMAScript &quot;Object&quot; constructor</span>
b.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">undefined</span><span class="delimiter">&quot;</span></span>); <span class="comment">// ECMAScript 'undefined' value</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a variable is not found in <code>ENGINE_SCOPE</code>, <code>GLOBAL_SCOPE</code> bindings are being searched.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There&#8217;s a confusion due to ECMAScript "global" properties being in <code>ENGINE_SCOPE</code> (toplevel <em>"this"</em> in script) and not in <code>GLOBAL_SCOPE</code>.
</td>
</tr>
</table>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More on ScriptContexts and Bindings: <a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+jsr223+engine+notes" class="bare">https://wiki.openjdk.java.net/display/Nashorn/Nashorn+jsr223+engine+notes</a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_and_language_extensions">3. API and Language Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nashorn comes along with quite a few language and API extensions, additionally to the ECMAScript standard.
Let&#8217;s have a look at some of the IMHO most useful and interessting ones.</p>
</div>
<div class="sect2">
<h3 id="_print_function">3.1. Print Function</h3>
<div class="paragraph">
<p>Nashorn comes with a handy <code>print</code> function, which prints its arguments (after converting it to a string) to standard out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Hello World</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_beans">3.2. Java Beans</h3>
<div class="paragraph">
<p>With Nashorn, you get direct access to the properties of a Java bean, no need to use getters and setters anymore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> Date = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">java.util.Date</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> date = <span class="keyword">new</span> Date();
date.year += <span class="integer">1900</span>;
print(date.year);  <span class="comment">// 2015</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function_literals">3.3. Function Literals</h3>
<div class="paragraph">
<p>For simple, one-line functions, we don&#8217;t necessarily have to use curly braces (and can also ommit the <code>return</code> keyword):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">function</span> <span class="function">add</span>(a, b) a + b;
print(add(<span class="integer">1</span>, <span class="integer">2</span>);  <span class="comment">// 3</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_binding_properties">3.4. Binding Properties</h3>
<div class="paragraph">
<p>You can bind properties from one object to another object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> o1 = {};
<span class="keyword">var</span> o2 = { <span class="key">foo</span>: <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>};

Object.bindProperties(o1, o2);

print(o1.foo);    <span class="comment">// bar</span>
o1.foo = <span class="string"><span class="delimiter">'</span><span class="content">John</span><span class="delimiter">'</span></span>;
print(o2.foo);    <span class="comment">// John</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trimming_strings">3.5. Trimming Strings</h3>
<div class="paragraph">
<p>Additionally to <code>.trim()</code>, you can just trim your string object on the left or the right:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">print(<span class="string"><span class="delimiter">&quot;</span><span class="content">   bar</span><span class="delimiter">&quot;</span></span>.trimLeft());           <span class="comment">// bar</span>
print(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo   </span><span class="delimiter">&quot;</span></span>.trimRight() + <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// foobar</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_whereis">3.6. Whereis</h3>
<div class="paragraph">
<p>In case you get lost while programming:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">print(__FILE__, __LINE__, __DIR__);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_import_scopes">3.7. Import Scopes</h3>
<div class="paragraph">
<p>Sometimes it&#8217;s useful to import many java packages at once.
We can use the class <code>JavaImporter</code> to be used in conjunction with the <code>with</code> statement.
All class files from the imported packages are accessible within the local scope of the <code>with</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> imports = <span class="keyword">new</span> JavaImporter(java.io, java.lang);
<span class="keyword">with</span> (imports) {
    <span class="keyword">var</span> file = <span class="keyword">new</span> File(__FILE__);
    System.out.println(file.getAbsolutePath());  <span class="comment">// /path/to/my/script.js</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_packages">3.8. Packages</h3>
<div class="paragraph">
<p>Packages and related objects are there to support java package, class access from script.
The properties of the <code>Packages</code> variable are all the top-level Java packages, such as <code>java</code>, <code>javax</code> etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> Vector = Packages.java.util.Vector;

<span class="comment">// but short-cuts defined for important package prefixes like</span>
<span class="comment">//    Packages.java, Packages.javax, Packages.com</span>
<span class="comment">//    Packages.edu, Packages.javafx, Packages.org</span>

<span class="keyword">var</span> JFrame = javax.swing.JFrame;  <span class="comment">// javax == Packages.javax</span>
<span class="keyword">var</span> List = java.util.List;        <span class="comment">// java == Packages.java</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">jjs&gt; Packages.java
[JavaPackage java]
jjs&gt; java
[JavaPackage java]
jjs&gt; java.util.Vector
[JavaClass java.util.Vector]
jjs&gt; javax
[JavaPackage javax]
jjs&gt; javax.swing.JFrame
[JavaClass javax.swing.JFrame]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_typed_arrays">3.9. Typed Arrays</h3>
<div class="paragraph">
<p>Native JavaScript arrays are untyped.
Nashorn implements typed arrays as specified at <a href="https://www.khronos.org/registry/typedarray/specs/latest/" class="bare">https://www.khronos.org/registry/typedarray/specs/latest/</a>.</p>
</div>
<div class="paragraph">
<p>For example, create an array of <code>int</code> 's:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> IntArray = Java.type(<span class="string"><span class="delimiter">&quot;</span><span class="content">int[]</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">var</span> array = <span class="keyword">new</span> IntArray(<span class="integer">3</span>);
<span class="keyword">var</span> array[<span class="integer">0</span>] = <span class="integer">3</span>;
<span class="keyword">var</span> array[<span class="integer">1</span>] = <span class="integer">2</span>;
<span class="keyword">var</span> array[<span class="integer">2</span>] = <span class="integer">1</span>;

<span class="keyword">try</span> {
    array[<span class="integer">3</span>] = <span class="integer">0</span>;  <span class="comment">// would be possible in pure JS</span>
} <span class="keyword">catch</span> (e) {
    print(e.message);  <span class="comment">// Array index out of range: 3</span>
}

array[<span class="integer">0</span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>;
print(array[<span class="integer">0</span>]);  <span class="comment">// 42</span>

array[<span class="integer">0</span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">some wrong type</span><span class="delimiter">&quot;</span></span>;
print(array[<span class="integer">0</span>]);  <span class="comment">// 0</span>

array[<span class="integer">0</span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.14</span><span class="delimiter">&quot;</span></span>;
print(array[<span class="integer">0</span>]);  <span class="comment">// 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our <code>int[]</code> array behaves like a real Java int array.
Additionally, Nashorn performs implicit type conversion when trying to add some non-integer values.
Strings will automatically be converted to <code>int</code>, if possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_collections_and_for_each">3.10. Collections and For-Each</h3>
<div class="paragraph">
<p>Array handling in JavaScript is sometimes annoying. Let&#8217;s use Java collections instead!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> ArrayList = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">java.util.ArrayList</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> myList = <span class="keyword">new</span> ArrayList();
myList.add(<span class="string"><span class="delimiter">'</span><span class="content">John</span><span class="delimiter">'</span></span>);
myList.add(<span class="string"><span class="delimiter">'</span><span class="content">Jack</span><span class="delimiter">'</span></span>);
myList.add(<span class="string"><span class="delimiter">'</span><span class="content">Joe</span><span class="delimiter">'</span></span>);

<span class="keyword">for</span> each (<span class="keyword">var</span> e <span class="keyword">in</span> list) print(e);  <span class="comment">// John, Jack, Joe</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nashorns <code>for each</code> statement works like the <code>foreach</code> in Java.</p>
</div>
<div class="paragraph">
<p>Or, let&#8217;s use a <code>HashMap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> map = <span class="keyword">new</span> java.util.HashMap();
map.put(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">red</span><span class="delimiter">'</span></span>);
map.put(<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">green</span><span class="delimiter">'</span></span>);

<span class="keyword">for</span> each (<span class="keyword">var</span> e <span class="keyword">in</span> map.keySet()) print(e);  <span class="comment">// foo, bar</span>

<span class="keyword">for</span> each (<span class="keyword">var</span> e <span class="keyword">in</span> map.values()) print(e);  <span class="comment">// red, green</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_convert_arrays">3.11. Convert Arrays</h3>
<div class="paragraph">
<p>Some packages like <code>java.util</code> (and <code>java.lang</code>) can be accessed directly without utilizing <code>Java.type</code> or <code>JavaImporter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> list = <span class="keyword">new</span> java.util.ArrayList();
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jack</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code converts the Java list to a native JavaScript array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> jsArray = Java.from(list);
print(jsArray);                                  <span class="comment">// John,Jack,Joe</span>
print(Object.prototype.toString.call(jsArray));  <span class="comment">// [object Array]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And vice versa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> javaArray = Java.to([<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">5</span>, <span class="integer">8</span>, <span class="integer">13</span>], <span class="string"><span class="delimiter">&quot;</span><span class="content">int[]</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lambdas_and_streams">3.12. Lambdas and Streams</h3>
<div class="paragraph">
<p>As Lambdas and Streams are available since Java 8, it&#8217;s also possible to work with them in Nashorn! \o/</p>
</div>
<div class="paragraph">
<p>Although ECMAScript 5.1 lacks the compact arrow syntax from the Java 8 lambda expressions, we can use function literals where ever lambda expressions are accepted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> list = <span class="keyword">new</span> java.util.ArrayList();
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">a1</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">b1</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">c1</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">a3</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">b3</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">c3</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">a2</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">b2</span><span class="delimiter">&quot;</span></span>);
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">c2</span><span class="delimiter">&quot;</span></span>);

list
    .stream()
    .filter(<span class="keyword">function</span>(e) {
        <span class="keyword">return</span> e.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>);
    })
    .sorted()
    .forEach(<span class="keyword">function</span>(e) {
        print(e);
    });
<span class="comment">// a1, a2, a3</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extending_classes">3.13. Extending Classes</h3>
<div class="paragraph">
<p>Java types can simply be extended with the <code>Java.extend</code> extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> Runnable = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">java.lang.Runnable</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> Printer = Java.extend(Runnable, {
    <span class="function">run</span>: <span class="keyword">function</span>() {
        print(<span class="string"><span class="delimiter">'</span><span class="content">printed from a separate thread</span><span class="delimiter">'</span></span>);
    }
});

<span class="keyword">var</span> Thread = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">java.lang.Thread</span><span class="delimiter">'</span></span>);
<span class="keyword">new</span> Thread(<span class="keyword">new</span> Printer()).start();

<span class="keyword">new</span> Thread(<span class="keyword">function</span>() {
    print(<span class="string"><span class="delimiter">'</span><span class="content">printed from another thread</span><span class="delimiter">'</span></span>);
}).start();

<span class="comment">// printed from a separate thread</span>
<span class="comment">// printed from another thread</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As you can see, even multi-threaded code is possible in Nashorn.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_calling_super">3.14. Calling Super</h3>
<div class="paragraph">
<p>Accessing overridden members in JavaScript is traditionally awkward because Javas <code>super</code> keyword doesn&#8217;t exist in ECMAScript.
Luckily nashorn goes to the rescue.</p>
</div>
<div class="paragraph">
<p>First we define a super type in java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SuperRunner</span> <span class="directive">implements</span> <span class="predefined-type">Runnable</span> {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">super run</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we override <code>SuperRunner</code> from JavaScript.
Pay attention to the extended Nashorn syntax when creating a new <code>Runner</code> instance:
The syntax of overriding members is borrowed from Javas anonymous objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> SuperRunner = Java.type(<span class="string"><span class="delimiter">'</span><span class="content">dasniko.SuperRunner</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> Runner = Java.extend(SuperRunner);

<span class="keyword">var</span> runner = <span class="keyword">new</span> Runner() {
    <span class="function">run</span>: <span class="keyword">function</span>() {
        Java.<span class="reserved">super</span>(runner).run();
        print(<span class="string"><span class="delimiter">'</span><span class="content">local run</span><span class="delimiter">'</span></span>);
    }
}
runner.run();

<span class="comment">// super run</span>
<span class="comment">// local run</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We call the overridden method <code>SuperRunner.run()</code> by utilizing the <code>Java.super</code> extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_loading_scripts">3.15. Loading Scripts</h3>
<div class="paragraph">
<p>Loading and evaluating additional script files from Nashorn JavaScript is quite easy with the <code>load</code> function.
We can load local and external files.</p>
</div>
<div class="paragraph">
<p>In our example, we load the <a href="http://momentjs.com/">moment.js</a> library to calculate some dates and times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">load(<span class="string"><span class="delimiter">'</span><span class="content">https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.1/moment.min.js</span><span class="delimiter">'</span></span>);

<span class="keyword">var</span> now = <span class="keyword">new</span> moment();
print(now);
<span class="comment">// Thu Dec 31 2015 23:59:59 GMT+0100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The (external) script will be evaluated in the same context, so we can access the <code>moment</code> function directly.</p>
</div>
<div class="sect3">
<h4 id="_load_in_new_global_context">3.15.1. Load in new Global Context</h4>
<div class="paragraph">
<p>Loading external files can break your own code, when it is using same variable names as your code!
To avoid this, files can be loaded into a new global scope:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">loadWithNewGlobal(<span class="string"><span class="delimiter">'</span><span class="content">script.js</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the script is then only available in the Nashorn global context (not current engine context).</p>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An explicit description of all language and API extensions in Nashorn can be found at the <a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+extensions">Wiki page</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_package_manager">4. Working with Package Manager</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_npm">4.1. NPM</h3>
<div class="sect3">
<h4 id="_polyfill_js">4.1.1. Polyfill.js</h4>
<div class="listingblock">
<div class="title">nashorn-polyfill.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> global = <span class="local-variable">this</span>;
<span class="keyword">var</span> window = <span class="local-variable">this</span>;
<span class="keyword">var</span> process = {<span class="key">env</span>:{}};

<span class="keyword">var</span> console = {};
console.debug = print;
console.warn = print;
console.log = print;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jvm_npm">4.1.2. JVM-NPM</h4>

</div>
</div>
<div class="sect2">
<h3 id="_maven">4.2. Maven</h3>
<div class="sect3">
<h4 id="_nasven">4.2.1. Nasven</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_isomorphic_javascript">5. Isomorphic JavaScript</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_isomorphic">5.1. Isomorphic?</h3>

</div>
<div class="sect2">
<h3 id="_react_js">5.2. React.js</h3>

</div>
<div class="sect2">
<h3 id="_spring_boot_mvc">5.3. Spring Boot MVC</h3>

</div>
<div class="sect2">
<h3 id="_java_ee_8_mvc_1_0">5.4. Java EE 8 MVC 1.0</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_javafx_with_javascript">6. JavaFX with JavaScript</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_testing_of_nashorn_scripts">7. Testing of Nashorn Scripts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_junit">7.1. JUnit</h3>

</div>
<div class="sect2">
<h3 id="_spock">7.2. Spock</h3>

</div>
<div class="sect2">
<h3 id="_jasmine">7.3. Jasmine</h3>

</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-01-29 10:14:18 UTC
</div>
</div>
</body>
</html>